TARGET1 = qflex

# The folder where the Python interface is stored
CIRQ_IF_DIR = ../python/

# The name of the shared library that results after compiling QFlex for Pybind11
QFLEXLIB = $(CIRQ_IF_DIR)/$(TARGET1)`python3-config --extension-suffix`

OBJS1 = ordering.o grid.o circuit.o evaluate_circuit.o tensor.o contraction_utils.o \
    read_circuit.o docopt/docopt.o

CXXFLAGS += -Idocopt/ -fPIC -Ipycpp/include/

ifeq ($(CXX), icpc)
  CXXFLAGS += -DICPC
endif

# The flags for the compilation of the Pybind11 interface
PYCPPFLAGS = -shared `python3-config --includes` `python3-config --ldflags`

$(TARGET1): main.cpp $(OBJS1)
	$(CXX) -o $(@).x $< $(OBJS1) $(CXXFLAGS)

python_lib: $(OBJS1)
	$(CXX) pycpp_main.cpp -o $(QFLEXLIB) $^ $(CXXFLAGS) $(PYCPPFLAGS)

%.o: %.cpp %.h
	$(CXX) -c $< $(CXXFLAGS) -o $@

.PHONY: clean
clean:
	-rm -f ./*.x ./*.a ./*.so ./*.mod $(OBJS1)
	-rm -f $(QFLEXLIB)
